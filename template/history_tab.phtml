<script type="text/javascript">
    window.onpageshow = function() {
        new JsDatePick({
            useMode: 2,
            target: "inputFieldto",
            dateFormat: "%Y-%m-%d"
        });

        new JsDatePick({
            useMode: 2,
            target: "inputFieldfrom",
            dateFormat: "%Y-%m-%d"
        });
    };
</script>
<h3 align="center">Violations History</h3>

<table align="center" width="1000px"   >
    <tr>
        <td>

            <input class="history_violation_search search" placeholder="Search here..." type="text" size="30"  maxlength="1000" value="<?php if (isset($_GET['action']) && $_GET['action'] == "searchh" && isset($_GET['tab']) && $_GET['tab'] == 'violations-history') echo $_GET['value']; ?>" id="textBoxSearch"    /> 


        </td>
        <td>


            <a href="javascript:void(0);" class="myButton"  onclick="history_violation_search();">Search</a>

        </td>
        <td>


            <a href="javascript:void(0);" class="myButton"  onclick="history_violation_show_all();" >Show all</a>

        </td>
        <td>
            <form action=" ?tab=violations-history&option=show_dates" method="post"> 

                From<input type="text" size="12" name="from" id="inputFieldfrom" style=" background: white url(img/cal2.png) right no-repeat;"/> 
                To<input type="text" size="12" name="to" id="inputFieldto"  style=" background: white url(img/cal2.png) right no-repeat;"/>

                <input type="submit" class="myButton" name="submit" value="show" />
            </form>

        </td>




        <td> 

            Export To

            <select  id="exporth" name="export_to" class="dropdown" >
                <option value="csv" name="csv" selected  >Excel csv</option>
                <option value="xls" >Excel xls</option>
                <option value="pdf" >PDF</option>

            </select>
        </td>

        <td>

            <a href="" id="1" class="myButton" onclick="exporttoh();">Export</a>

        </td>
    </tr>
    <tr>
        <td>
            <div class="resultsh-per-page" >
                <select name="recent-limit" class="history-per-page"  >
                    <option <?php echo ($limit == 10) ? "selected" : ""; ?> value="10">10</option>
                    <option  <?php echo ($limit == 15) ? "selected" : ""; ?> value="15">15</option>
                    <option  <?php echo ($limit == 20) ? "selected" : ""; ?>  value="20">20</option>
                </select>
            </div>
        </td>
    </tr>


</table>



<div class="cleaner" style="padding-top: 15px; ">

</div>
<br/>
<table class="GrayBlack" align="center">
    <tr>
        <td>
            <?php
            echo " Violations from " . $from . " to " . $to . "<br/> ";
            ?>
        </td>
    </tr>
</table>

<table class="GrayBlack" align="center">
    <tbody id="data">
        <tr> 
            <td>
                SKU
                <a href="index.php?tab=<?php echo $tab_name; ?>&grid=history&dir=<?php echo ($direction == "asc" ? "desc" : "asc") ?>&sort=sku&<?php echo $page_param ?>=<?php echo $page ?><?php echo (isset($_GET['action']) && $_GET['action'] && isset($_GET['tab']) && $_GET['tab'] == 'violations-history' ? "&action=" . $_GET['action'] . "&field=" . $_GET['field'] . "&value=" . $_GET['value'] : "" ); ?><?php echo $additional_params; ?>" >
                    <img  style="float:right;" width="22" src="img/arrow_<?php echo ( $order_field == "sku" ? $direction : "asc" ); ?>_1.png" />
                </a>


            </td>	

            <td>
                Product
                <a href="index.php?tab=<?php echo $tab_name; ?>&grid=history&dir=<?php echo ($direction == "asc" ? "desc" : "asc") ?>&sort=pname&<?php echo $page_param ?>=<?php echo $page ?><?php echo (isset($_GET['action']) && $_GET['action'] && isset($_GET['tab']) && $_GET['tab'] == 'violations-history' ? "&action=" . $_GET['action'] . "&field=" . $_GET['field'] . "&value=" . $_GET['value'] : "" ); ?><?php echo $additional_params; ?>" >
                    <img  style="float:right;" width="22" src="img/arrow_<?php echo ( $order_field == "pname" ? $direction : "asc" ); ?>_1.png" />
                </a>

            </td>
            <td>
                Seller
                <a href="index.php?tab=<?php echo $tab_name; ?>&grid=history&dir=<?php echo ($direction == "asc" ? "desc" : "asc") ?>&sort=wname&<?php echo $page_param ?>=<?php echo $page ?><?php echo (isset($_GET['action']) && $_GET['action'] && isset($_GET['tab']) && $_GET['tab'] == 'violations-history' ? "&action=" . $_GET['action'] . "&field=" . $_GET['field'] . "&value=" . $_GET['value'] : "" ); ?><?php echo $additional_params; ?>" >
                    <img  style="float:right;" width="22" src="img/arrow_<?php echo ( $order_field == "wname" ? $direction : "asc" ); ?>_1.png" />
                </a>

            </td>	

            <td>
                Vendor price
                <a href="index.php?tab=<?php echo $tab_name; ?>&grid=history&dir=<?php echo ($direction == "asc" ? "desc" : "asc") ?>&sort=vendor_price&<?php echo $page_param ?>=<?php echo $page ?><?php echo (isset($_GET['action']) && $_GET['action'] && isset($_GET['tab']) && $_GET['tab'] == 'violations-history' ? "&action=" . $_GET['action'] . "&field=" . $_GET['field'] . "&value=" . $_GET['value'] : "" ); ?><?php echo $additional_params; ?>" >
                    <img  style="float:right;" width="22" src="img/arrow_<?php echo ( $order_field == "vendor_price" ? $direction : "asc" ); ?>_1.png" />
                </a>

            </td>
            <td>
                MAP price
                <a href="index.php?tab=<?php echo $tab_name; ?>&grid=history&dir=<?php echo ($direction == "asc" ? "desc" : "asc") ?>&sort=map_price&<?php echo $page_param ?>=<?php echo $page ?><?php echo (isset($_GET['action']) && $_GET['action'] && isset($_GET['tab']) && $_GET['tab'] == 'violations-history' ? "&action=" . $_GET['action'] . "&field=" . $_GET['field'] . "&value=" . $_GET['value'] : "" ); ?><?php echo $additional_params; ?>" >
                    <img  style="float:right;" width="22" src="img/arrow_<?php echo ( $order_field == "map_price" ? $direction : "asc" ); ?>_1.png" />
                </a>

            </td>
            <td>
                Violation amt

                <a href="index.php?tab=<?php echo $tab_name; ?>&grid=history&dir=<?php echo ($direction == "asc" ? "desc" : "asc") ?>&sort=violation_amount&<?php echo $page_param ?>=<?php echo $page ?><?php echo (isset($_GET['action']) && $_GET['action'] && isset($_GET['tab']) && $_GET['tab'] == 'violations-history' ? "&action=" . $_GET['action'] . "&field=" . $_GET['field'] . "&value=" . $_GET['value'] : "" ); ?><?php echo $additional_params; ?>" >
                    <img  style="float:right;" width="22" src="img/arrow_<?php echo ( $order_field == "violation_amount" ? $direction : "asc" ); ?>_1.png" />
                </a>
            </td>
            <td>Date
                <a href="index.php?tab=<?php echo $tab_name; ?>&grid=history&dir=<?php echo ($direction == "asc" ? "desc" : "asc") ?>&sort=date_executed&<?php echo $page_param ?>=<?php echo $page ?><?php echo (isset($_GET['action']) && $_GET['action'] && isset($_GET['tab']) && $_GET['tab'] == 'violations-history' ? "&action=" . $_GET['action'] . "&field=" . $_GET['field'] . "&value=" . $_GET['value'] : "" ); ?><?php echo $additional_params; ?>" >
                    <img  style="float:right;" width="22" src="img/arrow_<?php echo ( $order_field == "date_executed" ? $direction : "asc" ); ?>_1.png" />
                </a>
            </td>
            <td>
                Screenshot
            </td>
        </tr>

        <?php
        if (count($violators_array) == 0) {
            ?>
            <tr align="center"><td> No Records Found  </td> </tr>

            <?php
        }

        foreach ($violators_array as $violator) {

           $cell_id="vio";
		if ($violator->violation_amount >= 5 && $violator->violation_amount<10 )
			$cell_id="vioO";
		else if ($violator->violation_amount >= 10 )
			$cell_id="vioR";
            ?>
            <tr>
                <td><?php echo $violator->sku; ?></td>
                <td><?php echo $violator->pname; ?></td>
                <td><?php echo $violator->wname; ?></td>
                <td><?php echo "$".$violator->vendor_price; ?></td>
                <td><?php echo "$".$violator->map_price; ?></td>
                <td id="<?php echo $cell_id; ?>"><?php echo "$".$violator->violation_amount; ?></td>
                <td><?php echo $violator->date_executed; ?></td>
                <td><a href="<?php echo $violator->website_product_url; ?>" target="_blank">Link</a></td>			
            </tr>				
        <?php } ?>



    </tbody></table> 

<div align="left" style="display:block; ">
    <?php include ('page2.php'); ?>
</div>		

<div  class="chartt">
    <table>
        <tr>
            <td>
                <?php include_once 'charts/a5.php'; ?>
            </td>
            <td>
                <?php include_once 'charts/a6.php'; ?>
            </td>
        </tr>

    </table>
</div>

<script type="text/javascript">

    function history_violation_search() {
        var field = "sku";
        var value = $(".history_violation_search").val();
        var url_options = "";
        if (value.length) {
            url_options += "&action=searchh&field=" + field + "&value=" + value;
        }
        var search_link = "index.php?tab=violations-history" + url_options;
        window.open(search_link, "_self");
    }


    function exporttoh()
    {
        var mode = $("#exporth").val();
        var url_options = window.location.search.substring(1);

        if (url_options.length)
            url_options = '?' + url_options;

        if (mode)
            open("export_history_" + mode + ".php?" + $.param(queryParameters));
        //open("export_history_" + mode + ".php" + url_options);

    }

    function history_violation_show_all() {
        var search_link = "index.php?tab=violations-history";
        window.open(search_link, "_self");
    }

    $('.history-per-page').change(function() {
        var limit = $(this).val();
         var urlh="";
         urlh="index.php?tab=violations-history&";
	queryParameters['limit']=limit;
	location.search=urlh+$.param(queryParameters);
        //location.search=$.param(queryParameters);
    });

</script>