<table align="center"  cellpadding="5" cellspacing="10">
<tr> 

<td>
<h2><strong> Product Violations</strong></h2>
<div name="Product Violations" >
<table class="Dash">
 <tr> 
  <td width="250">
  <strong>SKU ID</strong>
   </td>	
   
  <td width="200">
  <strong>Price</strong>
   </td>
  
  </tr>					
<?php
include('db.php');
       
$sql="SELECT distinct prices.catalog_product_flat_1.sku,prices.catalog_product_flat_1.price
FROM
prices.catalog_product_flat_1
inner join
prices.crawl_results
on catalog_product_flat_1.entity_id = crawl_results.product_id 
inner join crawl
on
crawl_results.crawl_id = crawl.id
where crawl_results.violation_amount>0.5
 and 
crawl.id = 
(select max(crawl.id) from crawl) limit 10 ";
$result=mysql_query($sql);
      
  
        while($row = mysql_fetch_array($result)) 
       
	   { 
	        echo "<tr>";
            echo "<td>";
               echo  $row['sku']. "<td>" ."<a href=".">".$row['price']."</a><br>"; 
             echo "</td>";
             echo "</tr>"; 
	   }
		 echo "</table>"; 
 ?>
 </td>

 <td> 
<h2><strong> Vendor Violations</strong></h2>
<div name="Vendor Violations" > 
<table class="Dash" >
 <tr >
 <td >
  <strong>Dealers Name</strong>
   </td>	
   <td >
  <strong>current Count</strong>
   </td>
   <td >
  <strong>Previous Count</strong>
   </td>
   <td >
  <strong>Difference</strong>
   </td>
  
  </tr>
 <?php
include('db.php');

$sql1="SELECT
website.name name, count(crawl_results.website_id) countcurrent, tab1.countprev countprev, tab1.countprev - count(crawl_results.website_id) diff
from website
inner join
crawl_results
on website.id = crawl_results.website_id
inner join crawl
on crawl.id=crawl_results.crawl_id
and crawl_results.crawl_id = (select max(id) from crawl)
inner join
(
SELECT  
website.name name, count(crawl_results.website_id) countprev
from website
inner join
crawl_results
on website.id = crawl_results.website_id
inner join crawl
on crawl.id=crawl_results.crawl_id
and crawl_results.crawl_id = (select max(id)-1 from crawl)
group by website.name
) as tab1 on tab1.name = website.name
group by website.name limit 10
";
   
       
	    $result1=mysql_query($sql1);
        while($row = mysql_fetch_array($result1)) 
       { 
       echo "<tr>";
       echo "<td>";
	    echo "<a href=".">".$row['name']."</td>"."<td>".$row['countcurrent']."</td>"."<td>".$row['countprev']."</td>"."<td>".$row['diff']."</td>"."</tr>";
       echo "</td>";
       echo "</tr>";  
       } 
         echo "</table>";
       
 ?>	

  </td>
  </tr>
<tr>
  <td >
 <h2><strong>Top Violations Product</strong></h2> 
<div  name="Vendor Violations" >  
<table class="Dash">
     <tr>
<td width="250">
  <strong>SKU</strong>
   </td>	
   
  <td width="200">
  <strong>Violation Count</strong>
   </td>
  
  </tr>

<?php
include('db.php');

$sql2="select 
catalog_product_flat_1.sku,
count(crawl_results.product_id) as i_count
from
crawl_results
inner join
catalog_product_flat_1
on crawl_results.product_id = catalog_product_flat_1.entity_id
inner join
crawl
on crawl.id = crawl_results.crawl_id
and crawl_results.crawl_id = (select max(id) from crawl)
group by crawl_results.product_id
order by count(crawl_results.product_id) desc limit 10";
$result2=mysql_query($sql2);


        while($row = mysql_fetch_array($result2)) 
       { 
       
         echo "<tr>";
       echo "<td>";
      echo "<a href=".">".$row['sku']."</td>"."<td>".$row['i_count']."</td>"."</tr>";   
	  
       }
        echo "</table>";    
 ?>

</div>
</td>
         
<td ><h2><strong>Top Violation Vendor</strong></h2>
<div  name="Vendor Violations" > 
  <table class="Dash">
    <tr>
  
  <td width="250">
  <strong>SKU</strong>
   </td>
  <td width="200">
  <strong>Violation Amount</strong>
   </td>
  
  </tr>
<?php
include('db.php');

$sql3="SELECT
catalog_product_flat_1.sku,
crawl_results.violation_amount as violation_amount
from website
inner join
prices.crawl_results
on prices.website.id = prices.crawl_results.website_id
inner join catalog_product_flat_1
on catalog_product_flat_1.entity_id=crawl_results.product_id
inner join
crawl
on crawl.id=crawl_results.crawl_id
where crawl_results.violation_amount>0.05
and
website.excluded=0
AND crawl.id = (SELECT id FROM crawl ORDER BY id DESC LIMIT 1)
and
crawl.id =
(select max(crawl.id) from crawl) order by violation_amount desc
limit 10";
 $result3=mysql_query($sql3);
 
        while($row = mysql_fetch_array($result3)) 
       { 
         echo "<tr>";
		 echo "<td>";
      echo "<a href=".">".$row['sku']."</td>"."<td>$".$row['violation_amount']."</td>"."</tr>";
		 
     	 // echo  "<td>"."<a href=topViolationVendors.php?website_id=".$row['website_id'].">".$row['name']."</td><td>".$row['wi_count']."</td></a><br>";
       } 
         echo "</table>";
      // mysql_close($con); 
 ?>

</div>
 
</td> 
</tr>
</table>